(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[459],{8750:function(e,t,a){Promise.resolve().then(a.bind(a,7871))},6588:function(e,t,a){"use strict";a.d(t,{Z:function(){return o},e:function(){return i}});var l=a(7437),n=a(2265),s=a(3113);let r=[".txt",".md",".html",".css",".js",".json",".pdf",".jpg",".jpeg",".png",".gif",".svg",".webp",".bmp"];function i(e){let t=e.slice(e.lastIndexOf(".")).toLowerCase();return r.includes(t)}function o(e){let{filePath:t,fileName:a,onClose:r}=e,[i,o]=(0,n.useState)(null),[c,d]=(0,n.useState)(!0),[h,p]=(0,n.useState)(null),[m,u]=(0,n.useState)(""),x=a?a.slice(a.lastIndexOf(".")).toLowerCase():"";return((0,n.useEffect)(()=>{if(t){if(d(!0),p(null),".md"===x||".txt"===x){u("text"),fetch("".concat(s.S,"/api/file-manager/view?path=").concat(encodeURIComponent(t))).then(e=>{if(!e.ok)throw Error("Failed to load");return e.text()}).then(o).catch(p).finally(()=>d(!1));return}if([".jpg",".jpeg",".png",".gif",".svg",".webp",".bmp"].includes(x)){u("image"),o("".concat(s.S,"/api/file-manager/view?path=").concat(encodeURIComponent(t))),d(!1);return}if(".pdf"===x){u("pdf"),o("".concat(s.S,"/api/file-manager/view?path=").concat(encodeURIComponent(t))),d(!1);return}u("text"),fetch("".concat(s.S,"/api/file-manager/view?path=").concat(encodeURIComponent(t))).then(e=>{if(!e.ok)throw Error("Failed to load");return e.text()}).then(o).catch(p).finally(()=>d(!1))}},[t,x]),t)?(0,l.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm",onClick:r,children:(0,l.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col border border-slate-200",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-200",children:[(0,l.jsx)("h3",{className:"font-semibold text-slate-800 truncate",children:a}),(0,l.jsx)("button",{onClick:r,className:"p-2 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100",children:(0,l.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,l.jsxs)("div",{className:"flex-1 overflow-auto p-4 min-h-[200px] scrollbar-thin",children:[c&&(0,l.jsx)("p",{className:"text-slate-500",children:"Loading..."}),h&&(0,l.jsx)("p",{className:"text-red-600",children:h}),!c&&!h&&"image"===m&&i&&(0,l.jsx)("img",{src:i,alt:a,className:"max-w-full h-auto rounded-lg shadow-inner"}),!c&&!h&&"pdf"===m&&i&&(0,l.jsx)("embed",{src:i,type:"application/pdf",className:"w-full min-h-[70vh] rounded-lg border border-slate-200",title:a}),!c&&!h&&"text"===m&&null!=i&&(0,l.jsx)("pre",{className:"text-sm text-slate-700 bg-slate-50 p-4 rounded-lg overflow-x-auto whitespace-pre-wrap font-mono",children:i})]})]})}):null}},3113:function(e,t,a){"use strict";a.d(t,{S:function(){return l}});let l=a(257).env.NEXT_PUBLIC_API_URL||""},7871:function(e,t,a){"use strict";a.d(t,{default:function(){return c}});var l=a(7437),n=a(9376),s=a(2265),r=a(7648),i=a(3113),o=a(6588);function c(){let e=(0,n.useParams)().token,[t,a]=(0,s.useState)(null),[c,d]=(0,s.useState)(!1),[h,p]=(0,s.useState)([]),[m,u]=(0,s.useState)(!0),[x,f]=(0,s.useState)(null),[j,g]=(0,s.useState)(null);if((0,s.useEffect)(()=>{if(!e)return;let t=!1;return(async()=>{try{var l;let n=await fetch("".concat(i.S,"/api/file-manager/share?token=").concat(encodeURIComponent(e))),s=await n.json();if(s.error)throw Error(s.error);if(t)return;a(s.path);let r=null!==(l=s.isFile)&&void 0!==l&&l;if(d(r),r){let e=s.path.split("/").pop()||"Shared file";p([{path:s.path,name:e,type:"file"}])}else{let e=await fetch("".concat(i.S,"/api/file-manager/list?path=").concat(encodeURIComponent(s.path))),a=await e.json();!t&&a.items&&p(a.items)}}catch(e){t||f(e.message)}finally{t||u(!1)}})(),()=>{t=!0}},[e]),m)return(0,l.jsx)("div",{className:"min-h-screen bg-slate-100 flex items-center justify-center",children:(0,l.jsx)("div",{className:"text-slate-500",children:"Loading…"})});if(x||!t)return(0,l.jsx)("div",{className:"min-h-screen bg-slate-100 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"bg-white rounded-2xl shadow p-8 max-w-md text-center",children:[(0,l.jsx)("p",{className:"text-red-600 font-medium mb-4",children:x||"Link not found or expired."}),(0,l.jsx)(r.default,{href:"/",className:"text-purple-600 hover:underline",children:"Back to File Manager"})]})});let v=t.split("/").pop()||(c?"Shared file":"Shared folder");return(0,l.jsx)("div",{className:"min-h-screen bg-slate-100 p-6",children:(0,l.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,l.jsx)(r.default,{href:"/",className:"text-purple-600 hover:underline text-sm",children:"← Back to File Manager"}),(0,l.jsxs)("h1",{className:"text-xl font-semibold text-slate-800",children:["Shared: ",v]})]}),(0,l.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden",children:[(0,l.jsxs)("div",{className:"p-4 border-b border-slate-200 text-sm text-slate-500",children:["View-only. Path: ",(0,l.jsx)("span",{className:"font-mono text-slate-700",children:t})]}),(0,l.jsx)("div",{className:"p-4 grid grid-cols-2 sm:grid-cols-4 gap-4",children:0===h.length?(0,l.jsx)("p",{className:"col-span-full text-slate-400 text-sm",children:"This folder is empty."}):h.map(e=>{let t="file"===e.type&&(0,o.e)(e.name);return(0,l.jsxs)("div",{onClick:"file"===e.type?()=>{if("directory"!==e.type){if(t)g({path:e.path,name:e.name});else{let t=document.createElement("a");t.href="".concat(i.S,"/api/file-manager/download?path=").concat(encodeURIComponent(e.path)),t.download=e.name,t.click()}}}:void 0,className:"flex flex-col items-center p-4 rounded-xl border border-slate-200 bg-slate-50 ".concat("file"===e.type?"cursor-pointer hover:bg-slate-100 hover:border-purple-300 transition-colors":""),children:["directory"===e.type?(0,l.jsx)("svg",{className:"w-12 h-12 text-purple-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})}):(0,l.jsx)("svg",{className:"w-12 h-12 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,l.jsx)("span",{className:"mt-2 text-xs text-slate-700 truncate w-full text-center",children:e.name}),"file"===e.type&&t&&(0,l.jsx)("span",{className:"text-[10px] text-purple-500 mt-1",children:"Click to view"})]},e.path)})})]}),j&&(0,l.jsx)(o.Z,{filePath:j.path,fileName:j.name,onClose:()=>g(null)})]})})}}},function(e){e.O(0,[258,971,117,744],function(){return e(e.s=8750)}),_N_E=e.O()}]);